<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: models/user.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: models/user.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import fs from "node:fs/promises";
import path from "node:path";

const usersFile = path.join(process.cwd(), "src", "data", "users.json");

/**
 * @typedef {Symbol} Role
 */
/**
 * @typedef {Object} Roles
 * @property {Role} ADMIN
 * @property {Role} AUTHOR
 * @property {Role} USER
 */
/** @type {Readonly&lt;Roles>} */
const Roles = Object.freeze({
    /** @type {Role} */
    ADMIN: Symbol("admin"),
    /** @type {Role} */
    AUTHOR: Symbol("author"),
    /** @type {Role} */
    USER: Symbol("user"),
})

/**
 * User class
 */
class User {
    /**
     * @param {string} username
     * @param {string} email
     * @param {Role} role
     */
    constructor(username, email, role = Roles.USER) {
        /** @type {string} */
        this.username = username;
        /** @type {string} */
        this.email = email;
        /** @type {Role} */
        this.role = role;
    }

    /**
     * Logs in a user.
     * @param username
     * @param password
     * @returns {Promise&lt;User|null>}
     */
    static async loginUser(username, password) {
        try {
            const data = await fs.readFile(usersFile, "utf8");
            const users = JSON.parse(data);

            const user = users.find(
                (u) => u.username === username &amp;&amp; u.password === password,
            );

            return user || null;
        } catch (err) {
            console.error("Error validating user:", err);
            return null;
        }
    }

    /**
     * Registers a new user.
     * @param password
     * @returns {Promise&lt;boolean>}
     */
    async registerUser(password) {
        if (!this.username || !this.email || !password) return false;

        try {
            const data = await fs.readFile(usersFile, "utf8");
            const users = JSON.parse(data);

            // Check if user already exists
            if (users.some((u) => u.email === this.email)) {
                return false;
            }

            // Add new user
            users.push({username: this.username, email: this.email, password});
            await fs.writeFile(usersFile, JSON.stringify(users, null, 2));

            return true;
        } catch (err) {
            console.error("Error creating user:", err);
            return false;
        }
    }
}

export default User;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-routes_auth.html">routes/auth</a></li><li><a href="module-routes_index.html">routes/index</a></li></ul><h3>Classes</h3><ul><li><a href="Post.html">Post</a></li><li><a href="Session.html">Session</a></li><li><a href="User.html">User</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ADMIN">ADMIN</a></li><li><a href="global.html#AUTHOR">AUTHOR</a></li><li><a href="global.html#cookieMiddleware">cookieMiddleware</a></li><li><a href="global.html#errorHandler">errorHandler</a></li><li><a href="global.html#generateSessionId">generateSessionId</a></li><li><a href="global.html#loggerMiddleware">loggerMiddleware</a></li><li><a href="global.html#notFoundHandler">notFoundHandler</a></li><li><a href="global.html#parseCookies">parseCookies</a></li><li><a href="global.html#router">router</a></li><li><a href="global.html#sessionMiddleware">sessionMiddleware</a></li><li><a href="global.html#USER">USER</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Sat Jan 18 2025 11:50:03 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
